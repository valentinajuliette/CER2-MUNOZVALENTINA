<!-- carrito.html -->
{% extends 'base.html' %}
{% block title %}Carrito de Compras - Tienda Verde{% endblock %}
{% block content %}

<div id="titulo" class="container-fluid">
    <br>
    <h1 class="text-center">Mi Carrito</h1>
    <br>
</div>

<div class="container">
    <br>
    <form method="post" action="{% url 'actualizar_carrito' %}">
        {% csrf_token %}
        <ul class="list-group">
            {% if total_carrito > 0 %}
                <!-- Fila de encabezados -->
                <li class="list-group-item d-flex justify-content-between align-items-center bg-light">
                    <strong style="width: 400px;">Producto</strong>
                    <strong style="max-width: 180px;">Cantidad</strong>
                    <strong style="max-width: 180px;">Precio final</strong>
                    <span style="width: 80px;"></span> <!-- Espacio para el botón "Eliminar" -->
                </li>
            {% endif %}
            
            <!-- Iteración de los productos en el carrito -->
            {% for item in carrito_items %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div style="width: 400px;">
                        {{ item.producto.nombre }}
                    </div>
                    <div class="input-group" style="max-width: 180px;">
                        <input type="number" name="cantidad_{{ item.id }}" class="form-control"
                            value="{{ item.cantidad|default:1 }}" min="1" max="{{ item.producto.stock }}" style="width: 60px;">
                        <button class="btn btn-light" type="submit">Actualizar</button>
                    </div>
                    <span class="badge bg-dark rounded-pill">
                        ${{ item.total }}
                    </span>
                    <a href="{% url 'eliminar_del_carrito' item.id %}" class="btn btn-danger btn-sm">Eliminar</a>
                </li>
            {% empty %}
                <li class="list-group-item">El carrito está vacío.</li>
            {% endfor %}
        </ul>
        <!-- Mostrar el total del carrito solo si es distinto de 0 -->
        {% if total_carrito > 0 %}
            <div class="mt-3 text-end">
                <h3>Total del carrito: <span class="text">${{ total_carrito }}</span></h3>
            </div>
            <div class="mt-3 text-end">
                <a href="{% url 'finalizar_compra' %}" class="btn btn-success mt-3">Finalizar compra</a>
            </div>
        {% endif %}
    </form>
    
    <a href="{% url 'lista_productos' %}" class="btn btn-outline-dark mt-3">Seguir comprando</a>
</div>
{% endblock %}
